/*global MutationObserver, CSSRule */
/**
 * @fileOverview This file contains the _componentary_ module for
 * emulating Web Components behavior.
 * @name componentary.js<src>
 * @author Etienne Prud’homme
 * @version 1.0.0
 * @link https://github.com/notetiene/componentary
 * @todo Keep track of instances. This way, the style tag could be
 * removed.
 * @license MIT
 */
var components=function(){function e(e,t){var n;for(n in t)t.hasOwnProperty(n)&&void 0===e[n]&&(e[n]=t[n])}function t(e){var t=document.implementation.createHTMLDocument(""),n=document.createElement("style");return n.textContent=e.replace(/\$self/g,".componentary-lib-self-component"),t.body.appendChild(n),n.sheet.cssRules}function n(e,t){var r,o,a=0,l=null,i="";for(o=t&&""!==t?t+" ":"",r=e.length;a<r;a++)if(l=e[a],l.type!==CSSRule.MEDIA_RULE){if(l.type!==CSSRule.STYLE_RULE)throw new Error("Only style rules and media rules are currently supported for style scoping");i+=".componentary-lib-self-component"!==l.selectorText.trim()?o+l.cssText:l.cssText.replace(/\.componentary-lib-self-component/g,t)}else i+=" @media "+l.media.mediaText+" { ",i+=n(l.cssRules,t),i+=" }";return i}function r(e,r){var o=t(e),a=r.className,l="";if(a.length<10)throw new Error("“topNode” doesn’t contain classes to act asselector or is too short & risk to have collisions");return a="."+a.replace(/ /g,"."),l=n(o,a)}function o(e,t,n,o,a){var l=e+"-componentary-lib-style",i=document.getElementById(l),c=t||null,s=null,d=null,p=e+"-componentary-lib-scoped";return null!==i||"[object String]"!==Object.prototype.toString.apply(c)?o:(s=document.createElement("style"),s.id=l,d=document.createElement("div"),d.className=p,o.style&&(d.style.display=o.style.display),d.appendChild(o),o=d,n.appendChild(d),s.textContent=r(t,d),a&&""!==a&&(s.textContent+=r(a,d)),document.head.appendChild(s),o)}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")});var a={},l=document.createRange();l.selectNode(document.body);var i=function(e,t,n){if(e.constructor!==String||""===e)throw new Error("Cannot register the component. The name must be a String.");if(t.constructor!==String||""===t)throw new Error("Cannot register "+e+" component. The template must be a String.");if(void 0!==a[e]&&a.hasOwnProperty(e))throw new Error(e+" is an already registered component.");var r=n||{};Object.defineProperty(a,e,{enumerable:!1,configurable:!1,writable:!1,value:{template:t,proto:r}})},c=function(t,n){if(!a.hasOwnProperty(t))throw new Error("“"+t+"” is not a registered component");for(var r=a[t],i=n||"",c=r.proto.style||void 0,s=l.createContextualFragment(r.template),d=null,p=0,u=s.childNodes.length;p<u;p++)if(s.childNodes[p].nodeType===Node.ELEMENT_NODE||s.childNodes[p].nodeType===Node.DOCUMENT_FRAGMENT_NODE){d=s.childNodes[p];break}if(null===d)throw new Error("The “"+t+"” component doesn’t contain a valid node.");d=o(t,c,s,d,i);var m=r.proto.createdCallback||{};m instanceof Function&&m.call(d);var f=r.proto.attachedCallback;if(f instanceof Function){var h=new MutationObserver(function(t){for(var n=0,r=t.length;n<r;n++)"childList"===t[n].type&&t[n].removedNodes[0]===d&&(e(d,s),f.call(d))});h.observe(s,{childList:!0})}var y=r.proto.attributeChangedCallback;if(y instanceof Function){var v=new MutationObserver(function(e){for(var t=0,n=e.length;t<n;t++)"attributes"===e[t].type&&y.call(d)});v.observe(d,{attributes:!0})}return d};return{registerElement:i,createElement:c}}();
//# sourceMappingURL=componentary.min.js.map
